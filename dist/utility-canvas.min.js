(()=>{"use strict";var t={593:(t,i)=>{Object.defineProperty(i,"__esModule",{value:!0}),i.hexToRgb=i.clamp=void 0,i.clamp=(t,i,e)=>Math.min(Math.max(i,t),e),i.hexToRgb=t=>{const i=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return i?{r:parseInt(i[1],16),g:parseInt(i[2],16),b:parseInt(i[3],16)}:null}}},i={};function e(s){var h=i[s];if(void 0!==h)return h.exports;var r=i[s]={exports:{}};return t[s](r,r.exports,e),r.exports}(()=>{const t=e(593);class i{el;width;height;ctx;static COMPOSITE;constructor({canvas:t=document.createElement("canvas"),width:i=1024,height:e=1024,parent:s=null}={}){this.el=t,this.width=t.width=i,this.height=t.height=e;const h=t.getContext("2d");if(!h)throw new Error("Unable to get canvas context");this.ctx=h,s&&s.appendChild(t)}resize({width:t=this.width,height:i=this.height}={}){return this.width=this.el.width=t,this.height=this.el.height=i,this}clearRect({offset:{x:t=0,y:i=0}={x:0,y:0},width:e=this.width,height:s=this.height}={}){return this.ctx.clearRect(t,i,e,s),this}clear(){return this.clearRect()}setColor(t=this.ctx.fillStyle){return this.ctx.fillStyle=t,this}setStroke({thickness:t=this.ctx.lineWidth,color:i=this.ctx.strokeStyle}={}){return this.ctx.lineWidth=t,this.ctx.strokeStyle=i,this}setCompositeOperation(t=this.ctx.globalCompositeOperation){return i.COMPOSITE[t]?this.ctx.globalCompositeOperation=i.COMPOSITE[t]:Object.values(i.COMPOSITE).includes(t)?this.ctx.globalCompositeOperation=t:console.warn(`Composite operation: '${t}' does not exist.`),this}setAlpha(t=this.ctx.globalAlpha){return this.ctx.globalAlpha=t,this}_parseSettings(t){if(!t)return this;const{color:i,strokeOptions:e={},alpha:s,operation:h}=t;return this.setColor(i),this.setStroke(e),this.setAlpha(s),this.setCompositeOperation(h),this}fill(t){return this.ctx.save(),this._parseSettings(t),this.ctx.fill(),this.ctx.restore(),this}fillRect({offset:{x:t=0,y:i=0}={x:0,y:0},width:e=this.width,height:s=this.height,...h}={}){return this.ctx.save(),this._parseSettings(h),this.ctx.fillRect(t,i,e,s),this.ctx.restore(),this}fillImage(t,{preserveAspect:i=!1,...e}={}){return i?this.fillOrFitImage(t,{fill:"fill"===i,...e}):(this.ctx.save(),this._parseSettings(e),this.ctx.drawImage(t,0,0,this.width,this.height),this.ctx.restore(),this)}fillOrFitImage(t,{fill:i=!0,aspect:e=null,anchors:{x:s="center",y:h="center"}={},offset:{x:r=0,y:o=0}={},margin:a={t:0,l:0,r:0,b:0},...c}={}){e=e||(t.height||t.naturalHeight)/(t.width||t.naturalWidth),"number"==typeof a&&(a={t:a,l:a,r:a,b:a});const{t:n=0,l=0,r:x=0,b:g=0}=a,d=this.width-l-x,p=this.height-n-g;this.ctx.save(),this._parseSettings(c);const u=e/(p/d);if(1===u)this.ctx.drawImage(t,r+l,o+n,d,p);else if(u>1===i){const i=d*e,s="bottom"===h?p-i:"top"===h?0:(p-i)/2;this.ctx.drawImage(t,r+l,s+o+n,d,i)}else{const i=p/e,h="right"===s?d-i:"left"===s?0:(d-i)/2;this.ctx.drawImage(t,h+r+l,o+n,i,p)}return this.ctx.restore(),this}fillPattern(t,{repeat:i=null,stagger:e=null,rotation:s=0,offset:{x:h=0,y:r=0}={x:0,y:0},margin:{x:o=0,y:a=0}={x:0,y:0},anchors:{x:c="center",y:n="center"}={},...l}={}){const x=Math.abs(Math.cos(s)*this.width)+Math.abs(Math.sin(s)*this.height),g=Math.abs(Math.cos(s)*this.height)+Math.abs(Math.sin(s)*this.width);i=i||{x:x/((t.width||t.naturalWidth)+o),y:g/((t.height||t.naturalHeight)+a)};const d=this.width/i.x,p=this.height/i.y;"center"===c?h-=(Math.ceil(i.x)*d+o-x)/2:"right"===c&&(h-=Math.ceil(i.x)*d+o-x),"center"===n?r-=(Math.ceil(i.y)*p+a-g)/2:"bottom"===n&&(r-=Math.ceil(i.y)*p+a-g);const u=Math.ceil(i.x*x/(2*this.width)),I=Math.ceil(i.y*g/(2*this.height));this.ctx.save(),this._parseSettings(l),s&&(this.ctx.translate(this.width/2,this.height/2),this.ctx.rotate(s),this.ctx.translate(-x/2,-g/2));for(let s=-u;s<i.x+u;s++){let c=h+o+s*d,n=r+a;e&&"y"===e&&s%2&&(n-=p/2);for(let s=-I;s<i.y+I;s++)this.ctx.drawImage(t,e&&"x"===e&&s%2?c-d/2:c,n+s*p,d-o,p-a)}return this.ctx.restore(),this}beginPath(){return this.ctx.beginPath(),this}stroke(t){return this.ctx.save(),this._parseSettings(t),this.ctx.stroke(),this.ctx.restore(),this}closePath(){return this.ctx.closePath(),this}rectangle({offset:{x:t=0,y:i=0}={x:0,y:0},width:e=this.width,height:s=this.height,fill:h=!1,stroke:r=!1,...o}){this.ctx.save(),this._parseSettings(o);const{color:a,strokeOptions:c}=o;return h||r||a||c?(this.ctx.beginPath(),this.ctx.rect(t,i,e,s),this.ctx.closePath(),(h||a)&&this.fill(),(r||c)&&this.stroke()):this.ctx.rect(t,i,e,s),this.ctx.restore(),this}arc({center:{x:t=this.width/2,y:i=this.height/2}={x:this.width/2,y:this.height/2},radius:e=Math.min(this.width,this.height)/2,startAngle:s=0,endAngle:h=2*Math.PI,cc:r=!1,fill:o=!1,stroke:a=!1,...c}){this.ctx.save(),this._parseSettings(c);const{color:n,strokeOptions:l}=c;return o||a||n||l?(this.ctx.beginPath(),this.ctx.arc(t,i,e,s,h,r),this.ctx.closePath(),(o||n)&&this.fill(),(a||l)&&this.stroke()):this.ctx.arc(t,i,e,s,h,r),this.ctx.restore(),this}ellipse({center:{x:t=this.width/2,y:i=this.height/2}={x:this.width/2,y:this.height/2},radius:{x:e=this.width/2,y:s=this.height/2}={x:this.width/2,y:this.height/2},rotation:h=0,startAngle:r=0,endAngle:o=2*Math.PI,cc:a=!1,fill:c=!1,stroke:n=!1,...l}){this.ctx.save(),this._parseSettings(l);const{color:x,strokeOptions:g}=l;return c||n||x||g?(this.ctx.beginPath(),this.ctx.ellipse(t,i,e,s,h,r,o,a),this.ctx.closePath(),(c||x)&&this.fill(),(n||g)&&this.stroke()):this.ctx.ellipse(t,i,e,s,h,r,o,a),this.ctx.restore(),this}roundedRectangle({offset:{x:t=0,y:i=0}={x:0,y:0},width:e=this.width,height:s=this.height,radius:h,fill:r=!1,stroke:o=!1,...a}){"number"==typeof h&&(h={tl:h,tr:h,bl:h,br:h});const{tl:c,tr:n,bl:l,br:x}=h;this.ctx.save(),this._parseSettings(a),this.ctx.beginPath(),this.ctx.moveTo(t+c,i),this.ctx.lineTo(t+e-n,i),this.ctx.arc(t+e-n,i+n,n,Math.PI/2,0),this.ctx.lineTo(t+e,i+s-x),this.ctx.arc(t+e-x,i+s-x,x,0,Math.PI/2),this.ctx.lineTo(t+l,i+s),this.ctx.arc(t+l,i+s-l,l,-Math.PI/2,-Math.PI),this.ctx.lineTo(t,i+c),this.ctx.arc(t+c,i+c,c,Math.PI,Math.PI/2),this.ctx.closePath();const{color:g,strokeOptions:d}=a;return(r||g)&&this.fill(),(o||d)&&this.stroke(),this.ctx.restore(),this}polygon(t=[],{closed:i=!0,fill:e=!1,stroke:s=!1,...h}={}){if(!Array.isArray(t)||!t.length)return this;this.ctx.save(),this._parseSettings(h),this.ctx.beginPath(),this.ctx.moveTo(...t[0]);for(let i=1;i<t.length;i++)this.ctx.lineTo(...t[i]);const{color:r,strokeOptions:o}=h;return(i||e||r)&&(this.ctx.closePath(),(e||r)&&this.fill()),(s||o)&&this.stroke(),this.ctx.restore(),this}drawImage(t,{position:{x:i=0,y:e=0}={x:0,y:0},rotation:s=0,scale:h=1,...r}={}){return this.ctx.save(),this._parseSettings(r),this.ctx.translate(i,e),this.ctx.rotate(s),this.ctx.drawImage(t,-t.width*h/2,-t.height*h/2,t.width*h,t.height*h),this.ctx.restore(),this}drawImageWithDimensions(t,{width:i,height:e,position:{x:s=0,y:h=0}={x:0,y:0},rotation:r=0,...o}){return this.ctx.save(),this._parseSettings(o),this.ctx.translate(s,h),this.ctx.rotate(r),this.ctx.drawImage(t,-i/2,-e/2,i,e),this.ctx.restore(),this}chromaKey(i,e=.01){const s="string"==typeof i?t.hexToRgb(i):i;if(!s)return console.error(`Invalid color value: ${i}`),this;e=195075*Math.pow(t.clamp(e,.01,1),2);const h=this.ctx.getImageData(0,0,this.width,this.height);let r;for(let t=0;t<h.data.length;t+=4)r=Math.pow(h.data[t]-s.r,2)+Math.pow(h.data[t+1]-s.g,2)+Math.pow(h.data[t+2]-s.b,2),r<=e&&(h.data[t+3]=0);return this.ctx.putImageData(h,0,0),this}download(t="image/jpeg",i="export.jpg"){const e=document.createElement("a");e.href=this.getDataURL(t),e.download=i,e.click()}getDataURL(t="image/jpeg",i=1){return this.el.toDataURL(t,i)}setDataURL(t){const i=this,e=new Image;return new Promise((s=>{e.onload=()=>{i.fillImage(e),s()},e.src=t}))}}Object.defineProperty(i,"COMPOSITE",{value:{SOURCE_OVER:"source-over",OVERWRITE:"source-over",SOURCE_IN:"source-in",INTERSECT_REPLACE:"source-in",SOURCE_OUT:"source-out",AVOID_REPLACE:"source-out",SOURCE_ATOP:"source-atop",INTERSECT_ALPHA:"source-atop",DESTINATION_OVER:"destination-over",BEHIND:"destination-over",DESTINATION_IN:"destination-in",MASK:"destination-in",DESTINATION_OUT:"destination-out",REMOVE:"destination-out",DESTINATION_ATOP:"destination-atop",MASK_BEHIND:"destination-atop",LIGHTER:"lighter",ADD:"lighter",COPY:"copy",REPLACE:"copy",XOR:"xor",MULTIPLY:"multiply",SCREEN:"screen",DIVIDE:"screen",OVERLAY:"overlay",EXAGGERATE:"overlay",DARKEN:"darken",MIN:"darken",LIGHTEN:"lighten",MAX:"lighten",COLOR_DODGE:"color-dodge",COLOR_BURN:"color-burn",HARD_LIGHT:"hard-light",SOFT_LIGHT:"soft-light",DIFFERENCE:"difference",EXCLUSION:"exclusion",HUE:"hue",SATURATION:"saturation",COLOR:"color",LUMINOSITY:"luminosity"},writable:!1,enumerable:!0}),window.UtilityCanvas=i})()})();