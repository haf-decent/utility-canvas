(()=>{"use strict";var t={593:(t,e)=>{Object.defineProperty(e,"__esModule",{value:!0}),e.hexToRgb=e.clamp=void 0,e.clamp=(t,e,i)=>Math.min(Math.max(e,t),i),e.hexToRgb=t=>{const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null}}},e={};function i(s){var h=e[s];if(void 0!==h)return h.exports;var r=e[s]={exports:{}};return t[s](r,r.exports,i),r.exports}(()=>{const t=i(593);class e{el;width;height;ctx;static COMPOSITE;constructor({canvas:t=document.createElement("canvas"),width:e=1024,height:i=1024,parent:s=null}={}){this.el=t,this.width=t.width=e,this.height=t.height=i;const h=t.getContext("2d");if(!h)throw new Error("Unable to get canvas context");this.ctx=h,s&&s.appendChild(t)}resize({width:t=this.width,height:e=this.height}={}){return this.width=this.el.width=t,this.height=this.el.height=e,this}clearRect({offset:{x:t=0,y:e=0}={},width:i=this.width,height:s=this.height}={}){return this.ctx.clearRect(t,e,i,s),this}clear(){return this.clearRect()}setColor(t=this.ctx.fillStyle){return this.ctx.fillStyle=t,this}setStroke({thickness:t=this.ctx.lineWidth,color:e=this.ctx.strokeStyle}={}){return this.ctx.lineWidth=t,this.ctx.strokeStyle=e,this}setCompositeOperation(t=this.ctx.globalCompositeOperation){return e.COMPOSITE[t]?this.ctx.globalCompositeOperation=e.COMPOSITE[t]:Object.values(e.COMPOSITE).includes(t)?this.ctx.globalCompositeOperation=t:console.warn(`Composite operation: '${t}' does not exist.`),this}setAlpha(t=this.ctx.globalAlpha){return this.ctx.globalAlpha=t,this}_parseSettings(t){if(!t)return this;const{color:e,strokeSettings:i,alpha:s,operation:h}=t;return this.setColor(e).setStroke(i).setAlpha(s).setCompositeOperation(h)}fill(t){return this.ctx.save(),this._parseSettings(t),this.ctx.fill(),this.ctx.restore(),this}fillRect({offset:{x:t=0,y:e=0}={},width:i=this.width,height:s=this.height,...h}={}){return this.ctx.save(),this._parseSettings(h),this.ctx.fillRect(t,e,i,s),this.ctx.restore(),this}fillImage(t,{preserveAspect:e=!1,...i}={}){return e?this.fillOrFitImage(t,{fill:"boolean"==typeof e?e:"fill"===e,...i}):(this.ctx.save(),this._parseSettings(i),this.ctx.drawImage(t,0,0,this.width,this.height),this.ctx.restore(),this)}fillOrFitImage(t,{fill:e=!0,aspect:i=null,anchors:{x:s="center",y:h="center"}={},offset:{x:r=0,y:a=0}={},margin:o={t:0,l:0,r:0,b:0},...n}={}){i||(i=(t.height||t.naturalHeight)/(t.width||t.naturalWidth)),"number"==typeof o&&(o={t:o,l:o,r:o,b:o});const{t:c=0,l=0,r:g=0,b:x=0}=o,d=this.width-l-g,p=this.height-c-x;this.ctx.save(),this._parseSettings(n);const u=i/(p/d);if(1===u)this.ctx.drawImage(t,r+l,a+c,d,p);else if(u>1===e){const e=d*i,s="bottom"===h?p-e:"top"===h?0:(p-e)/2;this.ctx.drawImage(t,r+l,s+a+c,d,e)}else{const e=p/i,h="right"===s?d-e:"left"===s?0:(d-e)/2;this.ctx.drawImage(t,h+r+l,a+c,e,p)}return this.ctx.restore(),this}fillImagePattern(t,{repeat:e=null,stagger:i=null,rotation:s=0,offset:{x:h=0,y:r=0}={},margin:{x:a=0,y:o=0}={},anchors:{x:n="center",y:c="center"}={},...l}={}){const g=Math.abs(Math.cos(s)*this.width)+Math.abs(Math.sin(s)*this.height),x=Math.abs(Math.cos(s)*this.height)+Math.abs(Math.sin(s)*this.width);e=e||{x:g/((t.width||t.naturalWidth)+a),y:x/((t.height||t.naturalHeight)+o)};const d=this.width/e.x,p=this.height/e.y;"center"===n?h-=(Math.ceil(e.x)*d+a-g)/2:"right"===n&&(h-=Math.ceil(e.x)*d+a-g),"center"===c?r-=(Math.ceil(e.y)*p+o-x)/2:"bottom"===c&&(r-=Math.ceil(e.y)*p+o-x);const u=Math.ceil(e.x*g/(2*this.width)),f=Math.ceil(e.y*x/(2*this.height));this.ctx.save(),this._parseSettings(l),s&&(this.ctx.translate(this.width/2,this.height/2),this.ctx.rotate(s),this.ctx.translate(-g/2,-x/2));for(let s=-u;s<e.x+u;s++){let n=h+a+s*d,c=r+o;i&&"y"===i&&s%2&&(c-=p/2);for(let s=-f;s<e.y+f;s++)this.ctx.drawImage(t,i&&"x"===i&&s%2?n-d/2:n,c+s*p,d-a,p-o)}return this.ctx.restore(),this}beginPath(){return this.ctx.beginPath(),this}stroke(t){return this.ctx.save(),this._parseSettings(t),this.ctx.stroke(),this.ctx.restore(),this}closePath(){return this.ctx.closePath(),this}rect({offset:{x:t=0,y:e=0}={x:0,y:0},width:i=this.width,height:s=this.height,fill:h=!1,stroke:r=!1,...a}){this.ctx.save(),this._parseSettings(a);const{color:o,strokeSettings:n}=a;return h||r||o||n?(this.ctx.beginPath(),this.ctx.rect(t,e,i,s),this.ctx.closePath(),(h||o)&&this.fill(),(r||n)&&this.stroke()):this.ctx.rect(t,e,i,s),this.ctx.restore(),this}arc({center:{x:t=this.width/2,y:e=this.height/2}={x:this.width/2,y:this.height/2},radius:i=Math.min(this.width,this.height)/2,startAngle:s=0,endAngle:h=2*Math.PI,cc:r=!1,fill:a=!1,stroke:o=!1,...n}){this.ctx.save(),this._parseSettings(n);const{color:c,strokeSettings:l}=n;return a||o||c||l?(this.ctx.beginPath(),this.ctx.arc(t,e,i,s,h,r),this.ctx.closePath(),(a||c)&&this.fill(),(o||l)&&this.stroke()):this.ctx.arc(t,e,i,s,h,r),this.ctx.restore(),this}ellipse({center:{x:t=this.width/2,y:e=this.height/2}={x:this.width/2,y:this.height/2},radii:{x:i=this.width/2,y:s=this.height/2}={x:this.width/2,y:this.height/2},rotation:h=0,startAngle:r=0,endAngle:a=2*Math.PI,cc:o=!1,fill:n=!1,stroke:c=!1,...l}){this.ctx.save(),this._parseSettings(l);const{color:g,strokeSettings:x}=l;return n||c||g||x?(this.ctx.beginPath(),this.ctx.ellipse(t,e,i,s,h,r,a,o),this.ctx.closePath(),(n||g)&&this.fill(),(c||x)&&this.stroke()):this.ctx.ellipse(t,e,i,s,h,r,a,o),this.ctx.restore(),this}roundedRectangle({offset:{x:t=0,y:e=0}={x:0,y:0},width:i=this.width,height:s=this.height,radius:h,fill:r=!1,stroke:a=!1,...o}){"number"==typeof h&&(h={tl:h,tr:h,bl:h,br:h});const{tl:n=0,tr:c=0,bl:l=0,br:g=0}=h;this.ctx.save(),this._parseSettings(o),this.ctx.beginPath(),this.ctx.moveTo(t+n,e),this.ctx.lineTo(t+i-c,e),this.ctx.arc(t+i-c,e+c,c,Math.PI/2,0),this.ctx.lineTo(t+i,e+s-g),this.ctx.arc(t+i-g,e+s-g,g,0,Math.PI/2),this.ctx.lineTo(t+l,e+s),this.ctx.arc(t+l,e+s-l,l,-Math.PI/2,-Math.PI),this.ctx.lineTo(t,e+n),this.ctx.arc(t+n,e+n,n,Math.PI,Math.PI/2),this.ctx.closePath();const{color:x,strokeSettings:d}=o;return(r||x)&&this.fill(),(a||d)&&this.stroke(),this.ctx.restore(),this}polygon(t=[],{closed:e=!0,fill:i=!1,stroke:s=!1,...h}={}){if(t.length<2)return console.warn("Polygon not built: points array must have at least 2 points"),this;this.ctx.save(),this._parseSettings(h),this.ctx.beginPath(),this.ctx.moveTo(...t[0]);for(let e=1;e<t.length;e++)this.ctx.lineTo(...t[e]);const{color:r,strokeSettings:a}=h;return(e||i||r)&&(this.ctx.closePath(),(i||r)&&this.fill()),(s||a)&&this.stroke(),this.ctx.restore(),this}shape({sides:t,sideLength:e,radius:i,center:{x:s=this.width/2,y:h=this.height/2}={},rotation:r=0,...a}){if(!e&&!i)return console.warn("Error creating shape: sideLength or radius must be specified"),this;const o=i||e*Math.sin(Math.PI/t),n=[];for(let e=0;e<t;e++){const i=r+2*e*Math.PI/t;n.push([s+o*Math.sin(i),h+o*Math.cos(i)])}return this.polygon(n,a)}triangle({sideLength:t,...e}){return this.shape({sides:3,...e})}square(t){return this.shape({sides:4,...t})}rectangle({width:t,height:e,center:{x:i=this.width/2,y:s=this.height/2}={},rotation:h=0,...r}){const a=Math.sqrt(t/2^2+e/2^2),o=Math.atan2(t,e),n=Math.PI-o,c=[];for(let t=0;t<4;t++){const e=h+Math.floor(t/2)*Math.PI+t%2?n:o;c.push([i+a*Math.sin(e),s+a*Math.cos(e)])}return this.polygon(c,r)}pentagon(t){return this.shape({sides:5,...t})}hexagon(t){return this.shape({sides:6,...t})}heptagon(t){return this.shape({sides:7,...t})}octagon(t){return this.shape({sides:8,...t})}nonagon(t){return this.shape({sides:9,...t})}drawImage(t,{position:{x:e=0,y:i=0}={x:0,y:0},rotation:s=0,scale:h=1,...r}={}){return this.ctx.save(),this._parseSettings(r),this.ctx.translate(e,i),this.ctx.rotate(s),this.ctx.drawImage(t,-t.width*h/2,-t.height*h/2,t.width*h,t.height*h),this.ctx.restore(),this}drawImageWithDimensions(t,{width:e,height:i,position:{x:s=0,y:h=0}={x:0,y:0},rotation:r=0,...a}){return this.ctx.save(),this._parseSettings(a),this.ctx.translate(s,h),this.ctx.rotate(r),this.ctx.drawImage(t,-e/2,-i/2,e,i),this.ctx.restore(),this}chromaKey(e,i=.01){const s="string"==typeof e?(0,t.hexToRgb)(e):e;if(!s)return console.error(`Invalid color value: ${e}`),this;i=195075*Math.pow((0,t.clamp)(i,.01,1),2);const h=this.ctx.getImageData(0,0,this.width,this.height);let r;for(let t=0;t<h.data.length;t+=4)r=Math.pow(h.data[t]-s.r,2)+Math.pow(h.data[t+1]-s.g,2)+Math.pow(h.data[t+2]-s.b,2),r<=i&&(h.data[t+3]=0);return this.ctx.putImageData(h,0,0),this}download(t="image/jpeg",e="export.jpg"){const i=document.createElement("a");i.href=this.getDataURL(t),i.download=e,i.click()}getDataURL(t="image/jpeg",e=1){return this.el.toDataURL(t,e)}setDataURL(t){const e=this,i=new Image;return new Promise((s=>{i.onload=()=>{e.fillImage(i),s()},i.src=t}))}}Object.defineProperty(e,"COMPOSITE",{value:{SOURCE_OVER:"source-over",OVERWRITE:"source-over",SOURCE_IN:"source-in",INTERSECT_REPLACE:"source-in",SOURCE_OUT:"source-out",AVOID_REPLACE:"source-out",SOURCE_ATOP:"source-atop",INTERSECT_ALPHA:"source-atop",DESTINATION_OVER:"destination-over",BEHIND:"destination-over",DESTINATION_IN:"destination-in",MASK:"destination-in",DESTINATION_OUT:"destination-out",REMOVE:"destination-out",DESTINATION_ATOP:"destination-atop",MASK_BEHIND:"destination-atop",LIGHTER:"lighter",ADD:"lighter",COPY:"copy",REPLACE:"copy",XOR:"xor",MULTIPLY:"multiply",SCREEN:"screen",DIVIDE:"screen",OVERLAY:"overlay",EXAGGERATE:"overlay",DARKEN:"darken",MIN:"darken",LIGHTEN:"lighten",MAX:"lighten",COLOR_DODGE:"color-dodge",COLOR_BURN:"color-burn",HARD_LIGHT:"hard-light",SOFT_LIGHT:"soft-light",DIFFERENCE:"difference",EXCLUSION:"exclusion",HUE:"hue",SATURATION:"saturation",COLOR:"color",LUMINOSITY:"luminosity"},writable:!1,enumerable:!0}),window.UtilityCanvas=e})()})();