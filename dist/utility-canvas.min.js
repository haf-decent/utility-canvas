!function(t){var e={};function i(s){if(e[s])return e[s].exports;var r=e[s]={i:s,l:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=t,i.c=e,i.d=function(t,e,s){i.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:s})},i.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},i.t=function(t,e){if(1&e&&(t=i(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)i.d(s,r,function(e){return t[e]}.bind(null,r));return s},i.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return i.d(e,"a",e),e},i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},i.p="",i(i.s=0)}([function(t,e,i){"use strict";i.r(e),i.d(e,"UtilityCanvas",(function(){return h})),i.d(e,"clamp",(function(){return s})),i.d(e,"hexToRgb",(function(){return r}));const s=(t,e,i)=>Math.min(Math.max(e,t),i),r=t=>{const e=/^#?([a-f\d]{2})([a-f\d]{2})([a-f\d]{2})$/i.exec(t);return e?{r:parseInt(e[1],16),g:parseInt(e[2],16),b:parseInt(e[3],16)}:null};class h{constructor({canvas:t=document.createElement("canvas"),width:e=1024,height:i=1024,parent:s=null}={}){this.el=t,this.width=t.width=e,this.height=t.height=i,this.ctx=t.ctx=t.getContext("2d"),s&&s.appendChild(t)}resize({width:t=this.width,height:e=this.height}){return this.width=this.el.width=t,this.height=this.el.height=e,this}clear(){return this.ctx.clearRect(0,0,this.width,this.height),this}setColor(t=null){return t&&(this.ctx.fillStyle=t),this}setStroke({thickness:t=null,color:e=null}={}){return t&&(this.ctx.lineWidth=t),e&&(this.ctx.strokeStyle=e),this}setCompositeOperation(t){return h.COMPOSITE[t]?this.ctx.globalCompositeOperation=h.COMPOSITE[t]:t in Object.values(h.COMPOSITE)?this.ctx.globalCompositeOperation=t:console.warn(`Composite operation: '${t}' does not exist.`),this}fill(t=null){return this.ctx.save(),this.setColor(t),this.ctx.fill(),this.ctx.restore(),this}fillColor(t){return this.setColor(t),this.ctx.fillRect(0,0,this.width,this.height),this}fillTexture(t,e=!1){return e?this.fillOrFitTextureWithAspect({image:t,fill:"fill"===e}):(this.ctx.drawImage(t,0,0,this.width,this.height),this)}fillOrFitTextureWithAspect({image:t,fill:e=!0,aspect:i=null,anchors:s={x:"center",y:"center"},offset:r={x:0,y:0},margin:h={t:0,l:0,r:0,b:0}}){i=i||(t.naturalHeight||t.height)/(t.naturalWidth||t.width),"number"==typeof h&&(h={t:h,l:h,r:h,b:h});const{t:o,l:n,r:a,b:l}=h,c=this.width-n-a,u=this.height-o-l,x=i/(u/c);if(1===x)this.ctx.drawImage(t,r.x+n,r.y+o,c,u);else if(x>1===e){const e=c*i,h="bottom"===s.y?u-e:"top"===s.y?0:(u-e)/2;this.ctx.drawImage(t,r.x+n,h+r.y+o,c,e)}else{const e=u/i,h="right"===s.x?c-e:"left"===s.x?0:(c-e)/2;this.ctx.drawImage(t,h+r.x+n,r.y+o,e,u)}return(o||n||a||l)&&(this.ctx.save(),this.ctx.globalCompositeOperation="destination-in",this.ctx.fillStyle="#ffffff",this.ctx.fillRect(o,n,c,u),this.ctx.restore()),this}fillBackground({color:t=null,image:e=null,alpha:i=this.ctx.globalAlpha}={}){return this.ctx.save(),this.ctx.globalCompositeOperation="destination-over",this.ctx.globalAlpha=i,t?this.fillColor(t):e&&this.ctx.drawImage(e,0,0,this.width,this.height),this.ctx.restore(),this}beginPath(){return this.ctx.beginPath(),this}stroke(t={}){return this.ctx.save(),this.setStroke(t),this.ctx.stroke(),this.ctx.restore(),this}closePath(){return this.ctx.closePath(),this}rectangle({position:{x:t=0,y:e=0}={},width:i=this.width,height:s=this.height,fill:r=!1,stroke:h=!1}){return r||h?(this.ctx.beginPath(),this.ctx.rect(t,e,i,s),this.ctx.closePath(),r&&this.fill(r),h&&this.stroke(h)):this.ctx.rect(t,e,i,s),this}arc({center:{x:t,y:e},radius:i,startAngle:s=0,endAngle:r=2*Math.PI,cc:h=!1,fill:o=!1,stroke:n=!1}){return o||n?(this.ctx.beginPath(),this.ctx.arc(t,e,i,s,r,h),this.ctx.closePath(),o&&this.fill(o),n&&this.stroke(n)):this.ctx.arc(t,e,i,s,r,h),this}ellipse({center:{x:t,y:e},radius:{x:i,y:s},rotation:r=0,startAngle:h=0,endAngle:o=2*Math.PI,cc:n=!1,fill:a=!1,stroke:l=!1}){return a||l?(this.ctx.beginPath(),this.ctx.ellipse(t,e,i,s,r,h,o,n),this.ctx.closePath(),a&&this.fill(a),l&&this.stroke(l)):this.ctx.ellipse(t,e,i,s,r,h,o,n),this}roundedRectangle({position:{x:t=0,y:e=0},width:i=this.width,height:s=this.height,radius:r,fill:h=!1,stroke:o=!1}){"number"==typeof r&&(r={tl:r,tr:r,bl:r,br:r});const{tl:n,tr:a,bl:l,br:c}=r;return this.ctx.beginPath(),this.ctx.moveTo(t+n,e),this.ctx.lineTo(t+i-a,e),this.ctx.arc(t+i-a,e+a,a,Math.PI/2,0),this.ctx.lineTo(t+i,e+s-c),this.ctx.arc(t+i-c,e+s-c,c,0,Math.PI/2),this.ctx.lineTo(t+l,e+s),this.ctx.arc(t+l,e+s-l,l,-Math.PI/2,-Math.PI),this.ctx.lineTo(t,e+n),this.ctx.arc(t+n,e+n,n,Math.PI,Math.PI/2),this.ctx.closePath(),h&&this.fill(h),o&&this.stroke(o),this}draw({points:t=[],closed:e=!0,fill:i=!1,stroke:s=!1}={}){if(!Array.isArray(t)||!t.length)return this;this.ctx.beginPath(),this.ctx.moveTo(t[0]);for(let e=1;e<t.length;e++)this.ctx.lineTo(t[e]);return e&&(this.ctx.closePath(),i&&this.fill(i)),s&&this.stroke(s),this}drawTexture({image:t,position:{x:e=0,y:i=0}={},rotation:s=0,scale:r=1}){return this.ctx.save(),this.ctx.translate(e,i),this.ctx.rotate(s),this.ctx.drawImage(t,-t.width*r/2,-t.height*r/2,t.width*r,t.height*r),this.ctx.restore(),this}intersect(t){return this.ctx.save(),this.ctx.globalCompositeOperation="destination-in",this.ctx.drawImage(t,0,0,this.width,this.height),this.ctx.restore(),this}intersectWithRotation(t,e){return this.ctx.save(),this.ctx.globalCompositeOperation="destination-in",this.draw(t,{x:.5,y:.5},e,this.width/(1.414*t.width)),this.ctx.restore(),this}removeTexture({image:t,position:{x:e=0,y:i=0}={},rotation:s=0,scale:r=1}){return this.ctx.save(),this.ctx.translate(e,i),this.ctx.rotate(s),this.ctx.globalCompositeOperation="destination-out",this.ctx.drawImage(t,-t.width*r/2,-t.height*r/2,t.width*r,t.height*r),this.ctx.restore(),this}chromaKey(t,e=.01){const i="string"==typeof t?r(t):t;if(!i)return console.error("Invalid color value: "+t),this;e=195075*Math.pow(s(e,.01,1),2);const h=this.ctx.getImageData(0,0,this.width,this.height);let o;for(let t=0;t<h.data.length;t+=4)o=Math.pow(h.data[t]-i.r,2)+Math.pow(h.data[t+1]-i.g,2)+Math.pow(h.data[t+2]-i.b,2),o<=e&&(h.data[t+3]=0);return this.ctx.putImageData(h,0,0),this}download(t="image/jpeg",e="export.jpg"){const i=document.createElement("a");i.download=e,i.href=this.getDataURL(t),i.click()}getDataURL(t="image/jpeg",e=1){return this.el.toDataURL(t,e)}setDataURL(t){const e=this,i=new Image;return new Promise(s=>{i.onload=()=>{e.fillTexture(i),s()},i.src=t})}}Object.defineProperty(h,"COMPOSITE",{value:{SOURCE_OVER:"source-over",SOURCE_IN:"source-in",SOURCE_OUT:"source-out",SOURCE_ATOP:"source-atop",DESTINATION_OVER:"destination-over",DESTINATION_IN:"destination-in",DESTINATION_OUT:"destination-out",DESTINATION_ATOP:"destination-atop",LIGHTER:"lighter",COPY:"copy",XOR:"xor",MULTIPLY:"multiply",SCREEN:"screen",OVERLAY:"overlay",DARKEN:"darken",LIGHTEN:"lighten",COLOR_DODGE:"color-dodge",COLOR_BURN:"color-burn",HARD_LIGHT:"hard-light",SOFT_LIGHT:"soft-light",DIFFERENCE:"difference",EXCLUSION:"exclusion",HUE:"hue",SATURATION:"saturation",COLOR:"color",LUMINOSITY:"luminosity"},writable:!1,enumerable:!0}),window.UtilityCanvas=h;e.default=h}]);